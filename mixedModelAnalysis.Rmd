---
title: "Mixed Model analysis with spectra"
author: "Yusuf"
date: "2024-02-27"
output:
  html_document: 
    css: ../style/content.css
    theme: readable
    toc: yes
    toc_float: yes
  pdf_document:
    toc: yes
    toc_depth: '3'
fontsize: 12pt
editor_options: 
  chunk_output_type: inline
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, tidy=FALSE, prompt = TRUE, comment = NA, warning=FALSE, message=FALSE, collapse = TRUE,  class.source='bg-info', class.output='bg-info', tidy.opts=list(width.cutoff=70))
```







## Mixed model equation for spec canopyCover50
```{r}
load("./output/chipsSpecYieldBLUEs.rdata")
```

format data for r/ship matrix estimation
```{r}
pheno.cC50 <- chips_spec_yield %>%
  distinct(id, .keep_all = T) %>% 
  dplyr::select(-env, -yield) %>% 
  column_to_rownames("id") %>% 
  as.matrix()
```

Estimate r/ship matrix based on spectra info
```{r}
Z1<-scale(pheno.cC50,center=TRUE,scale=TRUE)
W1<-tcrossprod(Z1)/ncol(Z1)
W1[1:4,1:4]

```

plot spectra rlship matrix
```{r}
par(mfrow=c(1,3))
hist(W1[lower.tri(W1)], main='Off-diagonal values (lower-triangle) of the spectra r/ship')
hist(diag(W1), main='Diagonals of the spectra r/ship', breaks=20)
corrplot(W1, method="color", cl.pos="n", is.corr = F, tl.pos="n")

```


```{r}

```

######################################################################################################################################################################################################################################################################################

## Mixed model equation for spec canopyCoverFlower
```{r}
load("./output/chipsSpecYieldBLUEsccf.rdata")
```

format data for r/ship matrix estimation
```{r}
pheno.cCf <- chips_spec2_yield %>% 
  dplyr::select(-env, -yield) %>% 
  column_to_rownames("id") %>% 
  as.matrix()
```


Estimate r/ship matrix based on spectra info
```{r}
Z<-scale(pheno.cCf,center=TRUE,scale=TRUE)
G<-tcrossprod(Z)/ncol(Z)
```


######################################################################################################################################################################################################################################################################################

## Mixed model equation for spec PeakFlowering
```{r}
load("./output/chipsSpecYieldBLUEscpeakfl.rdata")
```

format data for r/ship matrix estimation
```{r}
pheno.cpf <- chips_spec3_yield %>% 
  select(-env, -yield) %>% 
  column_to_rownames("id") %>% 
  as.matrix()
```

Estimate r/ship matrix based on spectra info
```{r}
Z<-scale(pheno.cpf,center=TRUE,scale=TRUE)
G<-tcrossprod(Z)/ncol(Z)
```


######################################################################################################################################################################################################################################################################################
