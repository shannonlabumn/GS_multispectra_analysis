---
title: "Mixed Model analysis with spectra"
author: "Yusuf"
date: "2024-02-27"
output:
  html_document: 
    css: ../style/content.css
    theme: readable
    toc: yes
    toc_float: yes
  pdf_document:
    toc: yes
    toc_depth: '3'
fontsize: 12pt
editor_options: 
  chunk_output_type: inline
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, tidy=FALSE, prompt = TRUE, comment = NA, warning=FALSE, message=FALSE, collapse = TRUE,  class.source='bg-info', class.output='bg-info', tidy.opts=list(width.cutoff=70))
```







## Mixed model equation for spec canopyCover50
```{r}
load("./output/chipsSpecYieldBLUEs.rdata")
```

format data for r/ship matrix estimation
```{r}
pheno.cC50 <- chips_spec_yield %>%
  distinct(id, .keep_all = T) %>% 
  dplyr::select(-env, -yield) %>% 
  column_to_rownames("id") %>% 
  as.matrix()
```

Estimate r/ship matrix based on spectra info
```{r}
Z1<-scale(pheno.cC50,center=TRUE,scale=TRUE)
W1<-tcrossprod(Z1)/ncol(Z1)
W1[1:4,1:4]

```

plot spectra rlship matrix
```{r}
par(mfrow=c(1,3))
hist(W1[lower.tri(W1)], main='Off-diagonal values (lower-triangle) of the spectra r/ship')
hist(diag(W1), main='Diagonals of the spectra r/ship', breaks=20)
corrplot(W1, method="color", cl.pos="n", is.corr = F, tl.pos="n")

```


```{r}

```

######################################################################################################################################################################################################################################################################################

## Mixed model equation for spec canopyCoverFlower
```{r}
load("./output/chipsSpecYieldBLUEsccf.rdata")
```

format data for r/ship matrix estimation
```{r}
pheno.cCf <- chips_spec2_yield %>% 
  dplyr::select(-env, -yield) %>% 
  column_to_rownames("id") %>% 
  as.matrix()
```


Estimate r/ship matrix based on spectra info
```{r}
Z2<-scale(pheno.cCf,center=TRUE,scale=TRUE)
W2<-tcrossprod(Z2)/ncol(Z2)

```

plot spectra rlship matrix
```{r}
par(mfrow=c(1,3))
hist(W2[lower.tri(W2)], main='Off-diagonal values (lower-triangle) of the spectra r/ship at canopy cover flowering')
hist(diag(W2), main='Diagonals of the spectra r/ship', breaks=20)
corrplot(W2, method="color", cl.pos="n", is.corr = F, tl.pos="n")

```

######################################################################################################################################################################################################################################################################################

## Mixed model equation for spec PeakFlowering
```{r}
load("./output/chipsSpecYieldBLUEscpeakfl.rdata")
```

format data for r/ship matrix estimation
```{r}
pheno.cpf <- chips_spec3_yield %>% 
  dplyr::select(-env, -yield) %>% 
  column_to_rownames("id") %>% 
  as.matrix()
```

Estimate r/ship matrix based on spectra info
```{r}
Z3<-scale(pheno.cpf,center=TRUE,scale=TRUE)
W3<-tcrossprod(Z3)/ncol(Z3)
```

plot spectra rlship matrix
```{r}
par(mfrow=c(1,3))
hist(W3[lower.tri(W3)], main='Off-diagonal values (lower-triangle) of the spectra r/ship')
hist(diag(W3), main='Diagonals of the spectra r/ship', breaks=20)
corrplot(W3, method="color", cl.pos="n", is.corr = F, tl.pos="n")

```


######################################################################################################################################################################################################################################################################################
## Mixed model equation for spec vineBiomass
```{r}
load("./output/chipsSpecYieldBLUEscvineBiom.rdata")
```

format data for r/ship matrix estimation
```{r}
pheno.cvB <- chips_spec4_yield %>% 
  dplyr::select(-env, -yield) %>% 
  column_to_rownames("id") %>% 
  as.matrix()
```

Estimate r/ship matrix based on spectra info
```{r}
Z4<-scale(pheno.cvB,center=TRUE,scale=TRUE)
W4<-tcrossprod(Z4)/ncol(Z4)
```

plot spectra rlship matrix
```{r}
par(mfrow=c(1,3))
hist(W4[lower.tri(W4)], main='Off-diagonal values (lower-triangle) of the spectra r/ship')
hist(diag(W4), main='Diagonals of the spectra r/ship', breaks=20)
corrplot(W4, method="color", cl.pos="n", is.corr = F, tl.pos="n")

```

######################################################################################################################################################################################################################################################################################
## Mixed model equation for spec senecense1
```{r}
load("./output/chipsSpecYieldBLUEscS1.rdata")
```

format data for r/ship matrix estimation
```{r}
pheno.cS1 <- chips_spec5_yield %>% 
  dplyr::select(-env, -yield) %>% 
  column_to_rownames("id") %>% 
  as.matrix()
```

Estimate r/ship matrix based on spectra info
```{r}
Z5<-scale(pheno.cC50,center=TRUE,scale=TRUE)
W5<-tcrossprod(Z5)/ncol(Z5)
```

plot spectra rlship matrix
```{r}
par(mfrow=c(1,3))
hist(W5[lower.tri(W5)], main='Off-diagonal values (lower-triangle) of the spectra r/ship')
hist(diag(W5), main='Diagonals of the spectra r/ship', breaks=20)
corrplot(W5, method="color", cl.pos="n", is.corr = F, tl.pos="n")

```

######################################################################################################################################################################################################################################################################################
## Mixed model equation for spec senecense2
```{r}
load("./output/chipsSpecYieldBLUEscS2.rdata")
```


format data for r/ship matrix estimation
```{r}
pheno.cS2 <- chips_spec6_yield %>% 
  dplyr::select(-env, -yield) %>% 
  column_to_rownames("id") %>% 
  as.matrix()
```

Estimate r/ship matrix based on spectra info
```{r}
Z6<-scale(pheno.cS2,center=TRUE,scale=TRUE)
W6<-tcrossprod(Z6)/ncol(Z6)
```

plot spectra rlship matrix
```{r}
par(mfrow=c(1,3))
hist(W6[lower.tri(W1)], main='Off-diagonal values (lower-triangle) of the spectra r/ship')
hist(diag(W6), main='Diagonals of the spectra r/ship', breaks=20)
corrplot(W6, method="color", cl.pos="n", is.corr = F, tl.pos="n")

```


